"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[448],{5816:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>i,contentTitle:()=>c,default:()=>E,frontMatter:()=>o,metadata:()=>l,toc:()=>r});var d=t(7624),s=t(2172);const o={description:"Common Table Expressions \u9012\u5f52\u67e5\u8be2"},c="MySQL\u9012\u5f52\u67e5\u8be2",l={id:"storage/mysql/001\u9012\u5f52\u67e5\u8be2",title:"MySQL\u9012\u5f52\u67e5\u8be2",description:"Common Table Expressions \u9012\u5f52\u67e5\u8be2",source:"@site/docs/storage/mysql/001\u9012\u5f52\u67e5\u8be2.md",sourceDirName:"storage/mysql",slug:"/storage/mysql/001\u9012\u5f52\u67e5\u8be2",permalink:"/blog/docs/storage/mysql/001\u9012\u5f52\u67e5\u8be2",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{description:"Common Table Expressions \u9012\u5f52\u67e5\u8be2"},sidebar:"storageSidebar",previous:{title:"Storage",permalink:"/blog/docs/category/storage"},next:{title:"greeting",permalink:"/blog/docs/storage/redis/greeting"}},i={},r=[{value:"CTE (Common Table Expression)",id:"cte-common-table-expression",level:2},{value:"RECURSIVE CTE",id:"recursive-cte",level:2},{value:"\u57fa\u672c\u9012\u5f52\u67e5\u8be2",id:"\u57fa\u672c\u9012\u5f52\u67e5\u8be2",level:3},{value:"\u5176\u4ed6\u67e5\u8be2",id:"\u5176\u4ed6\u67e5\u8be2",level:3},{value:"\u67e5\u8be2\u8282\u70b9\u8def\u5f84\uff08\u81ea\u9876\u5411\u4e0b\uff09",id:"\u67e5\u8be2\u8282\u70b9\u8def\u5f84\u81ea\u9876\u5411\u4e0b",level:4},{value:"\u67e5\u8be2\u6240\u6709\u5b50\u8282\u70b9\u4e2a\u6570\uff08\u81ea\u5e95\u5411\u4e0a\uff09",id:"\u67e5\u8be2\u6240\u6709\u5b50\u8282\u70b9\u4e2a\u6570\u81ea\u5e95\u5411\u4e0a",level:4},{value:"\u53c2\u8003",id:"\u53c2\u8003",level:2}];function a(n){const e={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.M)(),...n.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(e.h1,{id:"mysql\u9012\u5f52\u67e5\u8be2",children:"MySQL\u9012\u5f52\u67e5\u8be2"}),"\n",(0,d.jsx)(e.h2,{id:"cte-common-table-expression",children:"CTE (Common Table Expression)"}),"\n",(0,d.jsx)(e.p,{children:"CTE\uff08\u516c\u7528\u8868\u8fbe\u5f0f\uff09\u662f\u4e00\u4e2a\u4e34\u65f6\u7ed3\u679c\u7684\u96c6\u5408\uff0c\u4f5c\u7528\u57df\u4e3a\u5355\u6b21\u67e5\u8be2"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"WITH [RECURSIVE]\n        cte_name [(col_name [, col_name] ...)] AS (subquery)\n        [, cte_name [(col_name [, col_name] ...)] AS (subquery)] ...\n"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"cte_name: cte\u540d\u79f0\uff0c\u540e\u7eed\u4f7f\u7528"}),"\n",(0,d.jsx)(e.li,{children:"col_name: \u5217\u540d\uff0c\u672a\u6307\u5b9a\u65f6\u4ecesubquery\u4e2d\u63a8\u65ad"}),"\n",(0,d.jsx)(e.li,{children:"subquery\uff1asubquery\u90e8\u5206\u4ea7\u751f\u7ed3\u679c\u96c6\uff0c\u62ec\u53f7\u4e3a\u5fc5\u987b"}),"\n"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"WITH cte (col1, col2) AS\n(\n  SELECT 1, 2\n  UNION ALL\n  SELECT 3, 4\n)\nSELECT col1, col2 FROM cte;\n\n+------+------+\n| col1 | col2 |\n+------+------+\n|    1 |    2 |\n|    3 |    4 |\n+------+------+\n"})}),"\n",(0,d.jsx)(e.h2,{id:"recursive-cte",children:"RECURSIVE CTE"}),"\n",(0,d.jsx)(e.h3,{id:"\u57fa\u672c\u9012\u5f52\u67e5\u8be2",children:"\u57fa\u672c\u9012\u5f52\u67e5\u8be2"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"WITH RECURSIVE cte (n) AS\n(\n  SELECT 1\n  UNION ALL\n  SELECT n + 1 FROM cte WHERE n < 5\n)\nSELECT * FROM cte;\n\n+------+\n| n    |\n+------+\n|    1 |\n|    2 |\n|    3 |\n|    4 |\n|    5 |\n+------+\n"})}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"WITH \u540e\u5fc5\u987b\u5305\u542bRECURISIVE"}),"\n",(0,d.jsxs)(e.li,{children:["subquery\u4e2d\uff0c",(0,d.jsx)(e.code,{children:"SELECT 1"}),"\u4e3a\u521d\u59cb\u67e5\u8be2\uff08\u9012\u5f52\u5165\u53e3\uff09\uff0c",(0,d.jsx)(e.code,{children:"SELECT n + 1 FROM cte WHERE n < 5"}),"\u4e3a\u9012\u5f52\u90e8\u5206\uff0c\u67e5\u8be2\u7ec8\u6b62\u6761\u4ef6\uff08\u9012\u5f52\u51fa\u53e3\uff09\u4e3a\u9012\u5f52\u90e8\u5206\u7ed3\u679c\u4e3a\u7a7a; ",(0,d.jsx)(e.em,{children:"\u6bcf\u6b21\u8fed\u4ee3\u53ea\u4f1a\u5904\u7406\u4e0a\u4e00\u6b21\u8fed\u4ee3\u4ea7\u751f\u7684\u7ed3\u679c"})]}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"\u5176\u4ed6\u67e5\u8be2",children:"\u5176\u4ed6\u67e5\u8be2"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:'CREATE DATABASE IF NOT EXISTS test;\n\nCREATE TABLE IF NOT EXISTS test.node (\n    `id` INT NOT NULL AUTO_INCREMENT,\n    `name` VARCHAR(64) NOT NULL DEFAULT \'\',\n    `parent_id` INT NOT NULL DEFAULT 0,\n    PRIMARY KEY (`id`)\n) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4;\n\nINSERT INTO test.node (id, name, parent_id)\nVALUES(1, "node1", 0);\nINSERT INTO test.node (id, name, parent_id)\nVALUES(2, "node2", 1);\nINSERT INTO test.node (id, name, parent_id)\nVALUES(3, "node3", 1);\nINSERT INTO test.node (id, name, parent_id)\nVALUES(4, "node4", 2);\nINSERT INTO test.node (id, name, parent_id)\nVALUES(5, "node5", 2);\nINSERT INTO test.node (id, name, parent_id)\nVALUES(6, "node6", 5);\n\nselect * from test.node;\n\n+----+-------+-----------+\n| id | name  | parent_id |\n+----+-------+-----------+\n|  1 | node1 |         0 |\n|  2 | node2 |         1 |\n|  3 | node3 |         1 |\n|  4 | node4 |         2 |\n|  5 | node5 |         2 |\n|  6 | node6 |         5 |\n+----+-------+-----------+\n'})}),"\n",(0,d.jsx)(e.h4,{id:"\u67e5\u8be2\u8282\u70b9\u8def\u5f84\u81ea\u9876\u5411\u4e0b",children:"\u67e5\u8be2\u8282\u70b9\u8def\u5f84\uff08\u81ea\u9876\u5411\u4e0b\uff09"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"WITH RECURSIVE cte AS (\n    SELECT id,\n        name,\n        0 AS depth\n    FROM test.node\n    WHERE id = 1\n    UNION ALL\n    SELECT t.id,\n        CONCAT(cte.name, '->', t.name),\n        cte.depth + 1\n    FROM cte\n        INNER JOIN test.node AS t ON cte.id = t.parent_id\n)\nSELECT *\nFROM cte;\n\n+------+----------------------------+-------+\n| id   | name                       | depth |\n+------+----------------------------+-------+\n|    1 | node1                      |     0 |\n|    2 | node1->node2               |     1 |\n|    3 | node1->node3               |     1 |\n|    4 | node1->node2->node4        |     2 |\n|    5 | node1->node2->node5        |     2 |\n|    6 | node1->node2->node5->node6 |     3 |\n+------+----------------------------+-------+\n"})}),"\n",(0,d.jsx)(e.h4,{id:"\u67e5\u8be2\u6240\u6709\u5b50\u8282\u70b9\u4e2a\u6570\u81ea\u5e95\u5411\u4e0a",children:"\u67e5\u8be2\u6240\u6709\u5b50\u8282\u70b9\u4e2a\u6570\uff08\u81ea\u5e95\u5411\u4e0a\uff09"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sql",children:"WITH RECURSIVE cte AS (\n    SELECT parent_id\n    FROM test.node\n    UNION ALL\n    SELECT t.parent_id\n    FROM cte\n        INNER JOIN test.node AS t ON cte.parent_id = t.id\n)\nSELECT parent_id,\n    count(*) AS cnt\nFROM cte\nGROUP BY parent_id;\n\n+-----------+-----+\n| parent_id | cnt |\n+-----------+-----+\n|         0 |   6 |\n|         1 |   5 |\n|         2 |   3 |\n|         5 |   1 |\n+-----------+-----+\n"})}),"\n",(0,d.jsx)(e.h2,{id:"\u53c2\u8003",children:"\u53c2\u8003"}),"\n",(0,d.jsxs)(e.blockquote,{children:["\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.a,{href:"https://dev.mysql.com/doc/refman/8.0/en/with.html",children:"https://dev.mysql.com/doc/refman/8.0/en/with.html"})}),"\n"]})]})}function E(n={}){const{wrapper:e}={...(0,s.M)(),...n.components};return e?(0,d.jsx)(e,{...n,children:(0,d.jsx)(a,{...n})}):a(n)}},2172:(n,e,t)=>{t.d(e,{I:()=>l,M:()=>c});var d=t(1504);const s={},o=d.createContext(s);function c(n){const e=d.useContext(o);return d.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:c(n.components),d.createElement(o.Provider,{value:e},n.children)}}}]);