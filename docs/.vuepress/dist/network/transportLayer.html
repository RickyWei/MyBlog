<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Transport Layer | Want to be STRONG</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="need to learn">
    <link rel="preload" href="/blog/assets/css/0.styles.1bbf74cc.css" as="style"><link rel="preload" href="/blog/assets/js/app.bb53412d.js" as="script"><link rel="preload" href="/blog/assets/js/2.1ecff5ce.js" as="script"><link rel="preload" href="/blog/assets/js/5.732296ce.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.70906e3b.js"><link rel="prefetch" href="/blog/assets/js/11.9df5bdce.js"><link rel="prefetch" href="/blog/assets/js/12.1e0f372a.js"><link rel="prefetch" href="/blog/assets/js/13.b33f3834.js"><link rel="prefetch" href="/blog/assets/js/14.61e5fcd0.js"><link rel="prefetch" href="/blog/assets/js/15.c27a3279.js"><link rel="prefetch" href="/blog/assets/js/16.3c62e4db.js"><link rel="prefetch" href="/blog/assets/js/17.6e1287a8.js"><link rel="prefetch" href="/blog/assets/js/18.2d3fecad.js"><link rel="prefetch" href="/blog/assets/js/19.adf3a6f9.js"><link rel="prefetch" href="/blog/assets/js/20.6fe61772.js"><link rel="prefetch" href="/blog/assets/js/21.827394ff.js"><link rel="prefetch" href="/blog/assets/js/22.6ea1abea.js"><link rel="prefetch" href="/blog/assets/js/23.d741329e.js"><link rel="prefetch" href="/blog/assets/js/24.8b9733e3.js"><link rel="prefetch" href="/blog/assets/js/25.83ca319b.js"><link rel="prefetch" href="/blog/assets/js/26.98c6c43b.js"><link rel="prefetch" href="/blog/assets/js/27.2597fcbd.js"><link rel="prefetch" href="/blog/assets/js/28.c8fc0229.js"><link rel="prefetch" href="/blog/assets/js/29.1fbc8a3a.js"><link rel="prefetch" href="/blog/assets/js/3.5d660764.js"><link rel="prefetch" href="/blog/assets/js/30.d1207809.js"><link rel="prefetch" href="/blog/assets/js/31.23186788.js"><link rel="prefetch" href="/blog/assets/js/32.f8f61327.js"><link rel="prefetch" href="/blog/assets/js/33.2c6045ad.js"><link rel="prefetch" href="/blog/assets/js/34.3859f989.js"><link rel="prefetch" href="/blog/assets/js/35.3f10e11b.js"><link rel="prefetch" href="/blog/assets/js/36.79af458c.js"><link rel="prefetch" href="/blog/assets/js/37.35b882ef.js"><link rel="prefetch" href="/blog/assets/js/38.056a53a5.js"><link rel="prefetch" href="/blog/assets/js/39.3430dfca.js"><link rel="prefetch" href="/blog/assets/js/4.8df75cb5.js"><link rel="prefetch" href="/blog/assets/js/40.f83c5514.js"><link rel="prefetch" href="/blog/assets/js/41.5afc32aa.js"><link rel="prefetch" href="/blog/assets/js/42.72ddd11d.js"><link rel="prefetch" href="/blog/assets/js/43.a6482575.js"><link rel="prefetch" href="/blog/assets/js/44.0cc10987.js"><link rel="prefetch" href="/blog/assets/js/45.acab0f26.js"><link rel="prefetch" href="/blog/assets/js/46.d64f8315.js"><link rel="prefetch" href="/blog/assets/js/47.e7579196.js"><link rel="prefetch" href="/blog/assets/js/48.4ca71c27.js"><link rel="prefetch" href="/blog/assets/js/49.a627398c.js"><link rel="prefetch" href="/blog/assets/js/50.8a9b9459.js"><link rel="prefetch" href="/blog/assets/js/51.f60def76.js"><link rel="prefetch" href="/blog/assets/js/52.d5a5dcd0.js"><link rel="prefetch" href="/blog/assets/js/53.22ca7716.js"><link rel="prefetch" href="/blog/assets/js/54.cda69068.js"><link rel="prefetch" href="/blog/assets/js/55.9d23a1ea.js"><link rel="prefetch" href="/blog/assets/js/56.efd127cb.js"><link rel="prefetch" href="/blog/assets/js/57.8f079f4a.js"><link rel="prefetch" href="/blog/assets/js/58.bbce86dc.js"><link rel="prefetch" href="/blog/assets/js/59.fd8842c2.js"><link rel="prefetch" href="/blog/assets/js/6.2d8dca44.js"><link rel="prefetch" href="/blog/assets/js/7.0461910a.js"><link rel="prefetch" href="/blog/assets/js/8.dd094926.js"><link rel="prefetch" href="/blog/assets/js/9.068b4c6a.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.1bbf74cc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-6c202ce7><header class="navbar ,y-nav-gre" data-v-6c202ce7><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Want to be STRONG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/RickyWei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.linkedin.com/in/ruiji-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LinkedIn
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-6c202ce7></div> <aside class="sidebar" data-v-6c202ce7><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/RickyWei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.linkedin.com/in/ruiji-wei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LinkedIn
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/blog/fight/" class="sidebar-heading clickable"><span>Fight</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/algorithm/" class="sidebar-heading clickable"><span>Algorithm</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/cpp/" class="sidebar-heading clickable"><span>C/C++</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/network/" class="sidebar-heading clickable router-link-active open"><span>Network</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/network/applicationLayer.html" class="sidebar-link">应用层</a></li><li><a href="/blog/network/transportLayer.html" aria-current="page" class="active sidebar-link">Transport Layer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/network/transportLayer.html#udp" class="sidebar-link">UDP</a></li><li class="sidebar-sub-header"><a href="/blog/network/transportLayer.html#tcp" class="sidebar-link">TCP</a></li></ul></li><li><a href="/blog/network/networkLayer.html" class="sidebar-link">网络层</a></li><li><a href="/blog/network/linkLayer.html" class="sidebar-link">链路层</a></li><li><a href="/blog/network/physicalLayer.html" class="sidebar-link">物理层</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/os/" class="sidebar-heading clickable"><span>OS</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/design/" class="sidebar-heading clickable"><span>Design</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page" data-v-6c202ce7> <div class="theme-default-content content__default"><h1 id="transport-layer"><a href="#transport-layer" class="header-anchor">#</a> Transport Layer</h1> <h2 id="udp"><a href="#udp" class="header-anchor">#</a> UDP</h2> <h3 id="udp-header"><a href="#udp-header" class="header-anchor">#</a> UDP header</h3> <p><img src="/blog/assets/img/udpheader.740fa2a7.jpg" alt="UDP header"></p> <h2 id="tcp"><a href="#tcp" class="header-anchor">#</a> TCP</h2> <h3 id="tcp-header"><a href="#tcp-header" class="header-anchor">#</a> TCP header</h3> <p><img src="/blog/assets/img/tcpheader.719c8aba.jpg" alt="TCP header"></p> <h3 id="tcp-3-handshake"><a href="#tcp-3-handshake" class="header-anchor">#</a> TCP 3-handshake</h3> <p><img src="/blog/assets/img/tcphandshake.c9d5bcf7.jpg" alt="TCP handshake"></p> <ol><li>ISN(Initial Sequence Number) is select randomly</li> <li>3 times handshake is a kind of protect for server side.
In the case that client has sent SYN but get server's ACK and
SYN late(timeout), client thinks the server does not response
but server thinks handshake has completed and wait idlely.</li></ol> <h3 id="tcp-4-handwave"><a href="#tcp-4-handwave" class="header-anchor">#</a> TCP 4-handwave</h3> <p><img src="/blog/assets/img/tcphandwave.bc8c7ee2.jpg" alt="tcp 4 handwave"></p> <ol><li>TCP is duplex, it allows each of direction closed undependly</li> <li>There is a 2MSL(Max Segment Lifetime) time wait after active opener
<ol><li>To response passive opener's FIN and ACK, which allow server to re-send FIN if lost</li> <li>To get rid of old message delivered to new session which has same IP and port number</li></ol></li></ol> <h3 id="tcp-reliability"><a href="#tcp-reliability" class="header-anchor">#</a> TCP Reliability</h3> <h4 id="time-based-retransimission"><a href="#time-based-retransimission" class="header-anchor">#</a> time based Retransimission</h4> <ol><li>TCP RTO(Retransmission Timeout)based on RTT(Round Trip Time)</li> <li>TCP has a timer and retransimit after exceeding RTO</li> <li>Classic Method
<ol><li>$SRTT\leftarrow \alpha (SRTT)+(1-\alpha) RTT_{s}\qquad \alpha\in[0.8,0.9]$</li> <li>$RTO=\min(ubound,\max(lbound,(SRTT)\beta))\qquad \beta\in[1.3,2.0],ubound=1min,lbound=1s$</li></ol></li> <li>Standard Method
<ol><li>$srtt\leftarrow (1-g)(srtt)+(g)M\qquad M=\text{mean deviation}$</li> <li>$rttvar\leftarrow (1-h)(rttvar)+(h)(|M-srtt|)$</li> <li>$RTO=srtt+4(rttvar)$</li></ol></li></ol> <h4 id="fast-retransimission"><a href="#fast-retransimission" class="header-anchor">#</a> Fast Retransimission</h4> <p><img src="/blog/assets/img/fastretransimission.cf7226c4.jpg" alt="fast retransmission"></p> <ol><li>TCP reveiver sends ACK immeadately when received out of order segment</li> <li>When TCP server reveived duplicate ACK, it judges if these ACK caused by segemnt loss or network delay according to duplicate ACK threshold</li> <li>Fast Retransimission does not need to wait RTO</li></ol> <h3 id="tcp-flow-control"><a href="#tcp-flow-control" class="header-anchor">#</a> TCP Flow Control</h3> <h4 id="delary-ack"><a href="#delary-ack" class="header-anchor">#</a> Delary ACK</h4> <ol><li>Wait a little time to send ACK when received a packet</li> <li>Try to put ACK to the packet which will be sent to peer side</li></ol> <h4 id="nagle-algorithm"><a href="#nagle-algorithm" class="header-anchor">#</a> Nagle Algorithm</h4> <ol><li>Do not send small packet($&lt; SMSS(Sender Maximum Segment Size)$) when does not receive previous ACK</li> <li>Nagle works as sefl-clocking, the faster ACK comes back, the more data will be sent</li> <li>Nagle works on a trade-off which use less number packet(with big overload), but increase the delay</li></ol> <h4 id="slide-window"><a href="#slide-window" class="header-anchor">#</a> Slide Window</h4> <p><img src="/blog/assets/img/swnd.1265dd38.jpg" alt="send window"> <img src="/blog/assets/img/rwnd.45339d1f.jpg" alt="send window"></p> <ol><li>TCP header's windows size filed indicate empty receive buffer space(Bytes)</li> <li>$\max SEQ=ACK+\text{Window Size}$</li> <li>sender send window probesto query reveiver's free space, which forces recevier response ACK and Winodw Size</li> <li>SWS(Silly Window Syndrome) phenomenon means only small segment can be transimted
<ol><li>receiver does not advertise small window</li> <li>sender does not send small segment according to Nagle</li></ol></li></ol> <h3 id="tcp-congestion-control"><a href="#tcp-congestion-control" class="header-anchor">#</a> TCP Congestion Control</h3> <p><img src="/blog/assets/img/congestioncontrol.b0741616.png" alt="congestion control"></p> <h4 id="slow-start"><a href="#slow-start" class="header-anchor">#</a> Slow Start</h4> <ol><li>Slow start happens when connection established or packet loss</li> <li>Slow start happens after exchange of SYN and cwnd(Congestion Winodow) = IW(Initial Winodw) = SMSS</li> <li>If no loss packet，$W=2\times W_{pre}$</li> <li>Delay ACK is adopted after slow start since it decrease speed up ration</li> <li>TCP's send speed is $W/RTT$. cwnd will be decreased to half of previus value when W is too big, this time point is ssthresh(slow start threshold)</li></ol> <h4 id="congestion-avoidance"><a href="#congestion-avoidance" class="header-anchor">#</a> Congestion Avoidance</h4> <ol><li>After ssthresh，$cwnd_{t+1}=cwnd_{t}+SMSS*SMSS/cwnd_{t}$，cwnd+=about 1 for each time</li></ol> <h4 id="fast-recovery"><a href="#fast-recovery" class="header-anchor">#</a> Fast Recovery</h4> <ol><li>After fast retransimission，set $ssthresh=\max(\text{flight size}/2,2*SMSS)$</li> <li>After the decreasing, start with new ssthreash rather than $cwnd=1MSS$ with slow start</li></ol> <h3 id="tcp-seperate-each-packet"><a href="#tcp-seperate-each-packet" class="header-anchor">#</a> TCP seperate each &quot;packet&quot;</h3> <ol><li>TCP is stream protocol, receiver may receive half segment,
one segment or multiple segment at each time</li> <li>This is caused by
<ol><li>Nagle -&gt; It does not send small packet immeadeatly and try to send many segment together</li> <li>Recevier can not comsume segment from buffer quickly -&gt; TCP buffer accumulates many segment</li></ol></li> <li>Can be solved by
<ol><li>Construct a &quot;packet&quot; -&gt; define a packet header which indicate the length of data</li></ol></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/26/2020, 1:27:44 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/network/applicationLayer.html" class="prev">
        应用层
      </a></span> <span class="next"><a href="/blog/network/networkLayer.html">
        网络层
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.bb53412d.js" defer></script><script src="/blog/assets/js/2.1ecff5ce.js" defer></script><script src="/blog/assets/js/5.732296ce.js" defer></script>
  </body>
</html>
