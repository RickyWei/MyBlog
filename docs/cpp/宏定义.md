# 宏定义

## 宏定义的本质是 **替换**

```cpp
// 简单宏定义
// #define 宏名 字符串
#define PI 3.14

// 带参数宏定义
// #define 宏名 （参数表） 宏体
#define ADDONE(x) (x + 1)
```

## 宏替换时机

预处理阶段

## 常见错误

1. 使用必要的括号
2. 使用 `do{}while(0)` 包含多条语句

```cpp
#define SQUARE(x) x* x
int tmp = SQUARE(3 + 3);  // tmp = 3 + 3 * 3 + 3

#define SQUARE(x) ((x) * (x))
int tmp = SQUARE(3 + 3);  // tmp = ((3 + 3) * (3 + 3))
```

## 宏定义规则

1. 宏名用大写，末尾无分号
2. 宏定义的参数是无类型的，不做语法检查，不做表达式求解，只替换
3. 宏定义通常在文件的最开头
4. 宏定义可嵌套，但字符串 `""` 中永远不包含宏

## 特殊符号

```cpp
// "x"
#define TOSTR(x) #x
string s = TOSTR(123);  //"123"

// xy
#define CONN(x, y) x##y
int a = (123, 456);  // a=123456
```

## 常用宏

```cpp
// 防止重复包含
#ifndef _HEADER_H
#define _HEADER_H
// HEADER
#endif

//预定义的宏
__DATE__
__TIME__
__FILE__
__FUNCTION__
__LINE__
__cplusplus

//DEBUG
#define DBG(fmt, ...)             \
    do {                          \
        printf(fmt, __VA_ARGS__); \
    } while (0)
```
